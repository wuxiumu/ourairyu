---
title: 买好车工作一年总结
date: 2016-11-25 21:50:18 +0800
categories:
  - life
tags:
  - frontend-engineer
  - job
---

有段时间没写文章了，虽然总是想写些什么，但作为一个不那么高效的人，写作不像有些人那样信手拈来般容易。

针对本文的标题，需要对三点进行说明一下：

1. 「买好车」实际不是公司的名字，而是一个产品，但我们习惯用这个词来叫公司；
2. 我在这家公司的工作时间已经超过一年了；
3. 这篇文章与其说是「工作总结」，不如说是吐槽。

好了，如果看完上面的「免责声明」后还有兴趣的话，就继续往下看吧～

去年 9 月，我离开了待了两年多却在各方面看不到任何希望的一家做在线教育的公司，来到了现在这家看起来很有前途的做汽车行业的公司。当时在找工作时面试的几家公司基本都给了 offer，最终之所以选择了去买好车，主要因为以下几点：

1. 薪酬待遇虽然不是最好，但也还好；
2. 有能够让我施展拳脚的空间；
3. 虽然有些风险，但公司业务还算有前景。

当然，我选择了买好车并不代表会一直在这里工作，能够走多远，就看它能给我多少（金钱、空间、自由），以及它能否顺利地发展下去。

## 付出的

入职的第一天，在了解了技术部门和前端团队的基本情况之后，我满怀雄心壮志，将自己定位成在技术方面带领前端团队的人，打算倾尽所能将前端团队打造成不输于甚至超过其他公司的团队。

目前为止，除了平时的业务支持，我所做的符合自己定位的事情主要有三件：

1. 分支管理优化；
2. 前端工程优化；
3. 前后端分离。

要做这些事情都是事出有因，前两件在《[前端工程优化之路](/posts/engineering-problems-of-frontend-development/)》中有提及，第三件则在《[前后端分离之设想](/posts/blueprint-of-decoupling-web-architecture-with-node/)》中进行了说明。

### 分支管理优化

公司的 Git 分支略为混乱，我决定采用 Git Flow 去进行管理。要想使用一个新的东西，就得先小范围试运行，然后再逐渐向更大的群体推广。所以，我在前端团队的一次周会上向成员们简单介绍了什么是 Git Flow 以及它的好处，大家都表示可以尝试一下。就这样，我们前端团队率先用起了 Git Flow。

在前端小伙伴们基本都适应这种方式时，我觉得是时候开始向整个技术部门推广了。

随着开发人员的增多，因为不是每个人都对 Git 使用熟练，在提交代码与合并分支时问题频出，突显出了 Git 及 Git Flow 培训的重要性。每每在与分支管理方面出现问题时，我就会在群里说一次 Git Flow 的事情。

有几次负责管理分支的鱼蛋找到我，讨论 Git Flow 的场景应变能力。可能是他也觉得用 Git Flow 会比现行方案强很多，在了解了相关知识后，挑了内网刚搭建好 GitLab 没几天的日子向整个技术部门普及 Git Flow 并讲解 GitLab 和 SourceTree 的用法。

为了让大家有文字参考，我写了份相关文档。在分享会上，鱼蛋对照着文档讲解了 Git 的一些常用操作，以及 Git Flow 的基本概念；我说明了如何用 SourceTree 结合 GitLab 实行 Git Flow，并讨论了到底该怎么去实施 Git Flow。事后，我将文档完善了下，形成了《[团队中的 Git 实践](/posts/working-with-git-in-team/)》这篇文章。

经过几个月的实践，技术部门对 Git Flow 的使用越来越规范，也越来越重视，甚至成为是否能够继续留在公司工作的衡量标准——新入职的人如果在培训后还搞不懂 Git Flow，将会被「升级」。

### 前端工程优化

作为一名前端工程师，在看到一些视觉上看着还不错的网站，尤其是有点名气的公司的产品时都会习惯性地打开浏览器的开发者工具，看看这个网站的前端都使用了哪些技术，以揣测这家公司的前端团队的实力和技术栈。

毫无掩盖地说，在我刚入职时，公司的网站虽然在访问、使用上没什么问题，但前端工程真是烂得一塌糊涂……并且，按照当时的开发方式，在写跟 Java 项目结合的页面时得开代理，每个人都得去配置代理规则；把图片上传到 CDN 需要反复手动修改路径等信息……简直是麻烦得不得了！

那时已经债台高筑了，想在原来的基础上进行修改也不是不可以，但改动的代价很大，最好是能够推倒重来，不过不太现实。还好，不久之后公司业务方向转变，要做一个新的 to B 的产品，给了我从头开始的机会！

在做新的项目时，为了调试方便和模块化管理，我们决定将前、后端代码放到一个仓库中；为了提高编码效率和复用性，并能够让每个人都跟得上时代的步伐，采用 Sass 编写样式表，使用 ES6 编写脚本；考虑到不同环境中静态资源的地址不同，在发布时需要自动替换掉模板中的资源引用地址，于是选择了 FIS3 作为构建工具。搭配上一些编码、文件等规范，感觉变得正规了不少！

在快一年的实践中，证明了这套方案可行，但还有些许不足——

针对基于 Java 框架的项目，FIS3 在 JS 的模块化方面支持得不是很好。虽说开发 FIS3 的团队做了一个名为 [fis3-jello](https://github.com/fex-team/fis3-jello) 的相关解决方案，但不太适合我们的项目。

页面中用的静态资源文件都是未经压缩的，整个页面的脚本文件都快以「m」为单位了，因为 Java 项目在部署时并未接入前端文件的构建流程。为了解决这个问题，我给团队用的命令行工具 [bumblebee](https://github.com/ourai/bumblebee) 添加了 `upload` 和 `publish` 命令用于将构建后的静态资源文件上传到 CDN。

事情总不会如期望中那么顺利，在上传大量文件时会出现上传失败的情况。我认为这种问题主要是 CDN 提供商那边处理得不够好，但也不能等着他们去修复，得等到猴年马月去了！自己动手，丰衣足食。我将上传文件的逻辑改为分片上传，把大批量的文件切分成 n 个「片段」，粒度可以自定义，当一个「片段」中的文件全部上传完之后才会进行下一个。

问题解决是解决了，可因为各种原因还没有集成进发布系统。再加上没多久就要去做前后端分离的事情了，一时觉得没什么必要去弄了。

### 前后端分离

「前后端分离」是个老话题，也是一个经久不衰的话题。

有人觉得这种事情没必要去做，作为前端工程师就应该去了解甚至学会任职公司所使用的后端语言。可我觉得，虽然说是具体情况具体分析，但绝大部分情况需要分离。此举可令前后端工程师关系和睦，不浪费彼此生命；还能使前端的架构方式足够灵活，让前端工程师大展拳脚。另外，前端工程师可以去懂后端语言，但这应该是非强制性的。

起初为什么要搞前后端分离已经记不清了，应该是各种各样让人无力吐槽的蛋疼事情促使大家达成了一致的想法。并且，如果这件事情办成了，将会为前端团队打开一个新的局面。

团队里还没人做过这事，对于我们来说都很新鲜，这是一个探索、学习的过程。至于让谁去做，鉴于其他人当时都在研究 React Native，就交给了正在尝试用 Node.js 去做服务端开发的我。

说实话，在刚做的时候，我处于懵逼状态，该怎么进行下去，有些一头雾水。与其想太多，不如先把手动起来，于是我照着原来 Spring 框架中的文件结构在新建的仓库中用 Express 框架「复制」了一下。

光能在本地跑起来没啥用，找同时负责测试和运维的鱼蛋商量，在发布系统上添加了这个实验性项目的入口。把我编写的 shell 脚本接入进去，点击「开始部署」按钮，看到一行行日志打印在页面上，一切那么行云流水～
