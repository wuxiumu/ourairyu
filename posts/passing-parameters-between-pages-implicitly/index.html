<!DOCTYPE html><html lang="zh-CN" dir="ltr"><head><base href="/dev/"><meta charset="UTF-8"><title>页面间隐式传递参数 - 网道</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="keywords" content="欧雷,欧雷流,宅男的部屋,宅男部屋,宅男,ourai,ourairyu,developer,center,dev,network,front-end,web,网络开发,web开发,开发网络,开发中心"><link rel="author" href="https://plus.google.com/110971881899489153670/"><link rel="shortcut icon" href="images/favicon.ico"><link rel="stylesheet" href="stylesheets/matcha.min.css"><link rel="stylesheet" href="stylesheets/highlight.css"><link rel="stylesheet" href="stylesheets/site.css"><link rel="stylesheet" href="stylesheets/highlight.css"><link rel="stylesheet" href="stylesheets/pages/article.css"> <!--[if lt IE 8]><link rel="stylesheet" href="stylesheets/forbid.css"><![endif]--><!--[if lt IE 9]><script src="javascripts/html5shiv-printshiv.min.js"></script><![endif]--><script src="javascripts/jquery.min.js"></script><script src="javascripts/tatami.min.js"></script><script src="javascripts/matcha.min.js"></script></head><body itemscope itemtype="http://schema.org/WebPage" class="layout--sandwich" data-layout="article" data-page="none"><header class="layout-header"> <nav class="layout-nav layout-inner"><ul><li><a href="/">首页</a></li><li><a href="projects/">项目</a></li></ul> </nav> </header><main class="layout-container"><div class="layout-content layout-inner"> <article class="article" itemscope itemtype="http://schema.org/Article"> <header class="article-header"><div class="article-title"><h1 itemprop="name">页面间隐式传递参数</h1></div><div class="article-meta"> <time datetime="2012-08-10" itemprop="datePublished">Aug 10, 2012</time> JavaScript</div> </header><div class="article-body" itemprop="articleBody"><p>在工作的开发过程中有个查看报表的需求——从某个页面点击按钮打开报表页面（该页面为新建窗口）。进入报表页面的入口不是固定的页面，也不是固定的按钮，因此不同种类的报表传递的参数不同，并且各组参数之间没什么共同性。原本的实现方式是通过 URL 的 queryString 将参数传递到报表页面，正如前面所说，<strong>不同种类的报表传递的参数不同</strong>，于是报表页面就会出现以下一些问题：</p><ul><li>URL 过长，看起来很不美观；</li><li>需要对 queryString 进行解析与判断来判别是什么类型的报表；</li><li>如果未来多加一些类型的报表的话，判断也会随之增多，这样不仅代码量增加，维护起来也有点困难，还影响性能；</li><li>安全性欠佳，通过 queryString 找到规律的话，通过浏览器地址栏随便地输入一个符合规律的 URL 就能获得想要看的数据。</li></ul><p>鉴于以上几点，我利用父子页面能够互相访问对方 window 对象的特性，想了一个“<strong>页面间隐式传递参数</strong>”的方式。</p><h2 class="heading" id="javascript-">父页面（入口页面） JavaScript 代码</h2><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">window</span><span class="p">.</span><span class="nx">windowPool</span> <span class="o">=</span> <span class="p">[];</span>             <span class="c1">// 用于存储子页面的 window 对象及隐式传递的参数</span>

<span class="kd">var</span> <span class="nx">newWin</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span> <span class="nx">url</span> <span class="p">),</span>    <span class="c1">// 新建窗口，url 为报表页面地址</span>
  <span class="nx">reportParams</span> <span class="o">=</span> <span class="p">{};</span>                <span class="c1">// 报表所需参数</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">windowPool</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
  <span class="s2">"window"</span><span class="o">:</span> <span class="nx">newWin</span><span class="p">,</span>
  <span class="s2">"parameter"</span><span class="o">:</span> <span class="nx">reportParams</span>
<span class="p">});</span></code></pre></div><p>看到上段代码，也许会奇怪地问：“为什么要将子页面的 window 对象和报表参数分开，而不是将报表参数绑定在子页面的 window 对象上？”这是因为子页面如果刷新了的话，报表参数就会失效了。将子页面（报表页面）的 window 对象与报表参数组合成一个 JSON 添加到数组里是为了避免当从父页面（入口页面）打开多个显示不同种类报表的报表页面时，早先打开的报表页面刷新操作而引起的显示后打开的报表页面内容的问题。</p><h2 class="heading" id="javascript--1">子页面（报表页面） JavaScript 代码</h2><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">params</span><span class="p">,</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">for</span><span class="p">(</span> <span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">opener</span><span class="p">.</span><span class="nx">windowPool</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nx">opener</span><span class="p">.</span><span class="nx">windowPool</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nb">window</span> <span class="o">===</span> <span class="nb">window</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">params</span> <span class="o">=</span> <span class="nx">opener</span><span class="p">.</span><span class="nx">windowPool</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">parameter</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div><p>该方式在除了 IE6 之外的浏览器都能正常运行，IE6 没测试过，不清楚兼容性如何。</p></div> <footer class="article-footer"><div class="article-switcher"> <a href="/posts/definition-list-with-dl/" class="prev_article" title="用 DL 标签实现信息列表">用 DL 标签实现信息列表</a> <a href="/posts/ie-block-level-element-height-not-zero/" class="next_article" title="IE6、IE7 及 IE8 怪癖模式下空块级非替换元素高度不为 0">IE6、IE7 及 IE8 怪癖模式下空块级非替换元素高度不为 0</a></div><ul class="related_articles"><li><a href="/posts/how-to-improve-web-page-performance/" title="网站性能优化·前端篇">网站性能优化·前端篇</a></li><li><a href="/posts/fetch-url-of-script-file/" title="获取 JavaScript 脚本文件路径">获取 JavaScript 脚本文件路径</a></li><li><a href="/posts/definition-list-with-dl/" title="用 DL 标签实现信息列表">用 DL 标签实现信息列表</a></li><li><a href="/posts/ie-block-level-element-height-not-zero/" title="IE6、IE7 及 IE8 怪癖模式下空块级非替换元素高度不为 0">IE6、IE7 及 IE8 怪癖模式下空块级非替换元素高度不为 0</a></li><li><a href="/posts/container-margin-collapse/" title="容器与内部元素外边距重叠">容器与内部元素外边距重叠</a></li><li><a href="/posts/php-access-data-messy-code/" title="php 读取数据中文乱码解决方案">php 读取数据中文乱码解决方案</a></li><li><a href="/posts/horizontal-round-corner-menu/" title="圆角横向菜单实现技巧">圆角横向菜单实现技巧</a></li></ul> </footer> </article><div id="disqus_thread"></div> <script>var disqus_shortname="ouraidev";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div> </main> <footer class="layout-footer"><div class="layout-inner"><div class="footer-links"><div class="internal"> <b>内部通道</b><ul><li><a href="about/">关于本站</a></li><li><a href="links/">外部链接</a></li></ul></div><div class="other"> <b>狡兔三窟</b><ul><li><a href="http://ourai.ws/" target="_blank" rel="external nofollow">欧雷流</a></li><li><a href="https://github.com/ourai" target="_blank" rel="external nofollow">GitHub</a></li><li><a href="https://www.codewars.com/users/ourai" target="_blank" rel="external nofollow">Codewars</a></li><li><a href="http://segmentfault.com/u/ourai" target="_blank" rel="external nofollow">SegmentFault</a></li><li><a href="http://weibo.com/ourairyu" target="_blank" rel="external nofollow">微博</a></li></ul></div></div><p class="w3c_techs"><a href="http://validator.w3.org/check?uri=referer" target="_blank" rel="external nofollow"><img src="http://www.w3.org/html/logo/badge/html5-badge-h-css3-semantics.png" width="165" height="64" alt="HTML5 Powered with CSS3 / Styling, and Semantics" title="HTML5 Powered with CSS3 / Styling, and Semantics"></a></p><div class="profile" itemscope itemtype="http://schema.org/Person" lang="en"> <a href="http://lin.ourai.ws/" class="avatar_link" target="_blank" rel="external nofollow"><img class="avatar" src="images/avatars/mask_2d.jpg" itemprop="image" alt="欧雷"></a><div class="profile_info"><h3 class="author"><a href="http://lin.ourai.ws/" class="author_link" itemprop="name" target="_blank" rel="external nofollow">Ourai Lin</a></h3><p>Developer / Blogger</p></div></div><p class="copyright">Copyright © 2011-2015 <a href="http://ourai.ws/" target="_blank" rel="external nofollow" title="欧雷流">Ourai.WS</a></p><p class="dependencies">Powered by <a href="https://github.com/" target="_blank" rel="external nofollow" title="GitHub is the best place to share code with friends, co-workers, classmates, and complete strangers. Over four million people use GitHub to build amazing things together.">GitHub</a>, <a href="http://jekyllrb.com/" target="_blank" rel="external nofollow" title="Jekyll is a simple, blog-aware, static site generator. It takes a template directory containing raw text files in various formats, runs it through Markdown (or Textile) and Liquid converters, and spits out a complete, ready-to-publish static website suitable for serving with your favorite web server.">Jekyll</a>, <a href="http://disqus.com/" target="_blank" rel="external nofollow" title="Disqus is a free service that enables great online communities. As the web’s most popular discussion system, Disqus is used by millions of websites that cover pretty much any topic imaginable. Its magic is in connecting people to stuff worth talking about.">Disqus</a></p></div> </footer><script>Tatami.sandbox()</script><!--[if lt IE 8]><div class="forbidden_message"><p>很抱歉，本站不支持低于 Internet Explorer 8 的浏览器。</p><p>如果您想继续用 Internet Explorer 浏览器访问本站，请先<a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" target="_blank">升级</a>。</p></div><![endif]--></body></html>